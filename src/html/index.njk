{%- extends "_templates/_layout.njk" -%}
{%- import "_templates/_macro/_macro.njk" as macro %}

{% block content %}
	<div class="search-wrap">
		<div class="search-input-box">
			<label class="sound_only" for="search-input">검색</label>
			<input
					type="search"
					class="search-input"
					id="search-input"
					placeholder="상점 또는 서비스 이름 검색"
					autocomplete="off"
					oninput="document.querySelector('.search-clear').style.display=this.value ? 'block':'none';"
			>
			<button
					type="button"
					class="search-clear"
					onclick="const i=document.querySelector('.search-input'); i.value=''; i.focus(); this.style.display='none';">
				<i>검색어 지우기</i>
			</button>
			<button type="button" class="search-button">검색하기</button>
		</div>

		<div class="search-list-box">
			<div class="list-box" aria-labelledby="recent-search-heading">
				<strong class="list-box-title" id="recent-search-heading">최근 검색어</strong>
				<ul class="recent-search-words-list">
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">올리브영</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">문화상품권</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">mac</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">로션</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">스킨</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">문화상품권</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">타이어 후드</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
					<li class="recent-search-words-list-item">
						<button type="button" class="recent-search-word">직관 티켓</button>
						<button type="button" class="recent-search-word-delete x-button"><i>검색어 삭제</i></button>
					</li>
				</ul>

				<button type="button" class="clear-all-list">모두 지우기</button>

				<p class="empty empty-search-words-list">
					최근 검색어가 없습니다.
				</p>
			</div>
			<div class="list-box" aria-labelledby="popular-search-heading">
				<strong class="list-box-title" id="popular-search-heading">인기 검색어</strong>
				<ol class="popular-search-word-list">
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">문화상품권</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">타이어 후드</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">스킨</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">올리브영</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">로션</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">직관 티켓</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">올리브영</button>
					</li>
					<li class="popular-search-word-list-item">
						<button type="button" class="popular-search-word">mac</button>
					</li>
				</ol>
			</div>
		</div>
	</div>
	<script>
    (() => {
      const wrap = document.querySelector('.search-wrap');
      if (!wrap) return;

      const input = wrap.querySelector('.search-input');
      const clearBtn = wrap.querySelector('.search-clear');
      const recentList = wrap.querySelector('.recent-search-words-list');
      const emptyMsg = wrap.querySelector('.empty-search-words-list');
      const clearAllBtn = wrap.querySelector('.clear-all-list'); // ← 모두 지우기 버튼

      // ===== UI 상태 동기화 =====
      function syncUI() {
        if (clearBtn) {
          clearBtn.style.display = input.value ? 'block' : 'none';
        }
      }

      // ===== 최근 검색어 상태 동기화 =====
      function syncRecentState() {
        if (!recentList) return;

        const hasItems = !!recentList.querySelector('.recent-search-words-list-item');

        // empty 메시지 처리 (있으면 숨김 / 없으면 보임)
        if (emptyMsg) {
          emptyMsg.style.display = hasItems ? 'none' : 'flex';
        }

        // clear-all 버튼 처리 (있을 때만 보임)
        if (clearAllBtn) {
          clearAllBtn.style.display = hasItems ? 'inline-block' : 'none';
        }
      }

      // ===== 포커스 in/out 처리 =====
      input.addEventListener('focus', () => {
        wrap.classList.add('search-input-focus');
      });
      input.addEventListener('blur', () => {
        setTimeout(() => {
          if (!wrap.contains(document.activeElement)) {
            wrap.classList.remove('search-input-focus');
          }
        }, 50);
      });

      // ===== 클릭 이벤트 위임 =====
      wrap.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        if (btn.classList.contains('recent-search-word')) {
          input.value = btn.textContent.trim();
          input.dispatchEvent(new Event('input', { bubbles: true }));
          input.focus();
          wrap.classList.add('search-input-focus');
          syncUI();
          return;
        }

        if (btn.classList.contains('recent-search-word-delete')) {
          const li = btn.closest('.recent-search-words-list-item');
          if (li) li.remove();
          syncRecentState();
          return;
        }

        if (btn.classList.contains('popular-search-word')) {
          input.value = btn.textContent.trim();
          input.dispatchEvent(new Event('input', { bubbles: true }));
          input.focus();
          wrap.classList.add('search-input-focus');
          syncUI();
          return;
        }

        if (btn.classList.contains('clear-all-list')) {
          if (recentList) {
            recentList.querySelectorAll('.recent-search-words-list-item').forEach((li) => li.remove());
          }
          syncRecentState();
          return;
        }
      });

      input.addEventListener('input', syncUI);

      // ===== 초기 상태 정리 =====
      syncUI();
      syncRecentState();
    })();
	</script>

{%- endblock %}
